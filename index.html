<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Student Portal - Scholastic Academy Pro - School marist_brothers_high_eda4a711</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* LOCKED LIGHT THEME - FORCED LIGHT MODE */
        :root {
            --primary: #4b5563;
            --primary-dark: #374151;
            --secondary: #6b7280;
            --success: #059669;
            --danger: #dc2626;
            --warning: #d97706;
            --info: #2563eb;
            --light: #f8fafc;
            --dark: #1f2937;
            --border: #e5e7eb;
            --card-bg: #ffffff;
            --sidebar-bg: #f9fafb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Force light theme on all elements */
        * {
            color-scheme: light !important;
        }

        body {
            color-scheme: light !important;
            background-color: #f8fafc !important;
            color: #1f2937 !important;
            forced-color-adjust: none;
        }

        html, body, div, span, applet, object, iframe,
        h1, h2, h3, h4, h5, h6, p, blockquote, pre,
        a, abbr, acronym, address, big, cite, code,
        del, dfn, em, img, ins, kbd, q, s, samp,
        small, strike, strong, sub, sup, tt, var,
        b, u, i, center,
        dl, dt, dd, ol, ul, li,
        fieldset, form, label, legend,
        table, caption, tbody, tfoot, thead, tr, th, td,
        article, aside, canvas, details, embed,
        figure, figcaption, footer, header, hgroup,
        menu, nav, output, ruby, section, summary,
        time, mark, audio, video {
            background-color: transparent !important;
            color: #1f2937 !important;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e5e7eb 100%);
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* School Selection */
        .school-selector {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin: 20px auto;
            max-width: 600px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .school-selector h2 {
            color: var(--dark);
            margin-bottom: 20px;
        }

        .school-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .school-option {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .school-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .school-option i {
            font-size: 24px;
            color: var(--primary);
        }

        .school-info {
            flex: 1;
        }

        .school-name {
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .school-id {
            color: var(--secondary);
            font-size: 0.9rem;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #e5e7eb 100%);
        }

        .login-card {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 500px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .logo-section {
            margin-bottom: 40px;
        }

        .main-logo {
            max-width: 250px;
            height: auto;
            margin-bottom: 20px;
        }

        .login-card h1 {
            color: var(--dark); /* Fallback for browsers that don't support background-clip: text */
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            
            /* For gradient text effect */
            -webkit-background-clip: text;
            -moz-background-clip: text;
            background-clip: text;
            
            /* Make text transparent so gradient shows through */
            -webkit-text-fill-color: transparent;
            -moz-text-fill-color: transparent;
            color: transparent;
        }

        .login-card p {
            color: var(--secondary);
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        .current-school {
            background: var(--light);
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }

        .current-school span {
            font-weight: bold;
            color: var(--primary);
        }

        .qr-scanner-section {
            margin: 25px 0;
            text-align: center;
        }

        .qr-scanner-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
        }

        .qr-scanner-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .camera-container {
            display: none;
            margin: 25px 0;
            text-align: center;
        }

        #qrVideo {
            max-width: 100%;
            border-radius: 12px;
            border: 3px solid var(--border);
            box-shadow: var(--shadow);
        }

        .scanning-overlay {
            position: relative;
            margin: 15px auto;
            width: 300px;
            height: 300px;
        }

        .scan-line {
            position: absolute;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            animation: scan 1.5s infinite linear;
            box-shadow: 0 0 10px var(--primary);
        }

        @keyframes scan {
            0% { top: 10%; }
            100% { top: 90%; }
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 15px;
        }

        .form-control {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(75, 85, 99, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: var(--shadow);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: none;
            border-left: 4px solid;
        }

        .alert-danger {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border-left-color: #dc2626;
            color: #dc2626;
        }

        /* Dashboard */
        .dashboard {
            display: none;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            min-height: 90vh;
            border: 1px solid var(--border);
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 25px 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            opacity: 0.1;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            height: 50px;
            width: auto;
            filter: brightness(0) invert(1);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 800;
            color: white;
        }

        .school-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn-light {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-light:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            display: flex;
            min-height: 70vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            padding: 25px;
            border-right: 1px solid var(--border);
            flex-shrink: 0;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-section h3 {
            color: var(--dark);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--secondary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .sidebar-menu a:hover {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow);
        }

        .sidebar-menu a.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .welcome-section {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #bae6fd;
        }

        .welcome-section h2 {
            color: var(--dark);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .welcome-section p {
            color: var(--secondary);
            font-size: 1.1rem;
        }

        /* Student Profile */
        .student-profile {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .profile-header h2 {
            color: var(--dark);
            font-size: 1.6rem;
            font-weight: 700;
        }

        .profile-status {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            padding: 8px 15px;
            border-radius: 20px;
            color: #065f46;
            font-weight: 600;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .profile-card {
            background: var(--light);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--border);
        }

        .profile-card h3 {
            color: var(--dark);
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .info-label {
            color: var(--secondary);
            font-weight: 600;
            min-width: 150px;
        }

        .info-value {
            color: var(--dark);
            font-weight: 500;
            text-align: right;
            flex: 1;
        }

        /* Report Section */
        .report-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .report-viewer {
            background: var(--light);
            border-radius: 12px;
            padding: 20px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed var(--border);
        }

        .report-image {
            max-width: 100%;
            max-height: 500px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: transform 0.3s ease;
            display: none;
        }

        .report-image:hover {
            transform: scale(1.02);
        }

        /* QR Code Section */
        .qr-section {
            text-align: center;
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 15px;
            border: 2px dashed var(--border);
        }

        #studentQR {
            max-width: 200px;
            margin: 0 auto 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .qr-section p {
            color: var(--secondary);
            font-size: 0.9rem;
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 50px 20px 30px;
            margin-top: 50px;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 40px;
        }

        .footer-section h3 {
            color: white;
            font-size: 1.3rem;
            margin-bottom: 25px;
            position: relative;
            padding-bottom: 15px;
        }

        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: white;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: #d1d5db;
            text-decoration: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-links a:hover {
            color: white;
            transform: translateX(5px);
        }

        .social-links {
            display: flex;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .social-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .social-links a:hover {
            background: white;
            color: var(--primary);
            transform: translateY(-3px);
        }

        .copyright {
            text-align: center;
            padding-top: 40px;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #9ca3af;
            font-size: 0.9rem;
        }

        /* Mobile Responsiveness */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .login-card {
                padding: 30px;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .header-actions {
                width: 100%;
                justify-content: center;
            }

            .profile-grid {
                grid-template-columns: 1fr;
            }

            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .footer-section h3::after {
                left: 50%;
                transform: translateX(-50%);
            }

            .social-links {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 25px;
            }

            .header {
                padding: 20px;
            }

            .content-area {
                padding: 20px;
            }

            .student-profile {
                padding: 20px;
            }

            .btn {
                padding: 12px 20px;
                font-size: 14px;
            }

            .info-item {
                flex-direction: column;
                gap: 5px;
            }

            .info-label,
            .info-value {
                width: 100%;
                text-align: left;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Loading States */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            color: var(--secondary);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-info { background: #dbeafe; color: #1e40af; }

        /* Tooltips */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
            box-shadow: var(--shadow);
        }
    </style>
</head>
<body>
    <!-- School Selection Page (for multi-school) -->
    <div class="login-container" id="schoolSelectionPage">
        <div class="login-card fade-in">
            <div class="logo-section">
                <div style="width: 120px; height: 120px; margin: 0 auto 25px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; color: white;">ðŸŽ“</div>
                <h1>Scholastic Academy Pro - School marist_brothers_high_eda4a711</h1>
                <p>Multi-School Enhanced Student Portal</p>
                <p style="font-size: 0.9rem; color: var(--secondary); margin-top: 10px;">Select your school to continue</p>
            </div>

            <div class="current-school">
                <i class="fas fa-school"></i> Current School: <span id="selectedSchoolName">Scholastic Academy Pro - School marist_brothers_high_eda4a711</span>
            </div>

            <div class="school-list" id="schoolList">
                <!-- Schools will be loaded dynamically -->
                <div class="school-option" onclick="selectSchool('marist_brothers_high_eda4a711', 'Scholastic Academy Pro - School marist_brothers_high_eda4a711')">
                    <i class="fas fa-graduation-cap"></i>
                    <div class="school-info">
                        <div class="school-name">Scholastic Academy Pro - School marist_brothers_high_eda4a711</div>
                        <div class="school-id">School ID: marist_brothers_high_eda4a711</div>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>

            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
                <p style="font-size: 0.9rem; color: var(--secondary);">
                    <i class="fas fa-info-circle"></i> Contact your school administration for access credentials
                </p>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div class="login-container" id="loginPage" style="display: none;">
        <div class="login-card fade-in">
            <div class="logo-section">
                <div style="width: 120px; height: 120px; margin: 0 auto 25px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; color: white;">ðŸŽ“</div>
                <h1 id="currentSchoolName">Scholastic Academy Pro - School marist_brothers_high_eda4a711</h1>
                <p>Enhanced Student Portal</p>
                <p style="font-size: 0.9rem; color: var(--secondary); margin-top: 10px;">Access your complete academic profile</p>
            </div>

            <div class="current-school" id="currentSchoolBadge">
                <i class="fas fa-school"></i> School ID: <span id="currentSchoolId">marist_brothers_high_eda4a711</span>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="portalId"><i class="fas fa-id-card"></i> Portal ID</label>
                    <input type="text" id="portalId" class="form-control" placeholder="Enter your unique Portal ID" required>
                </div>

                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                </div>

                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Access Enhanced Portal
                </button>
            </form>

            <div class="qr-scanner-section">
                <button type="button" class="qr-scanner-btn" id="qrScannerBtn">
                    <i class="fas fa-qrcode"></i> Scan QR Code
                </button>
            </div>

            <div class="camera-container" id="cameraContainer">
                <video id="qrVideo" playsinline></video>
                <div class="scanning-overlay">
                    <div class="scan-line"></div>
                </div>
                <button type="button" class="btn" id="stopCameraBtn" style="background: var(--danger); color: white; margin-top: 15px;">
                    <i class="fas fa-stop"></i> Stop Camera
                </button>
            </div>

            <button type="button" class="btn" id="switchSchoolBtn" style="background: var(--secondary); color: white; margin-top: 15px; width: 100%;">
                <i class="fas fa-exchange-alt"></i> Switch School
            </button>

            <div id="errorMessage" class="alert alert-danger">
                <i class="fas fa-exclamation-triangle"></i> Invalid Portal ID or password. Please try again.
            </div>

            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
                <p style="font-size: 0.9rem; color: var(--secondary);">
                    <i class="fas fa-info-circle"></i> Use your student card QR code or enter credentials manually
                </p>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="header">
            <div class="header-content">
                <div class="header-brand">
                    <div style="width: 40px; height: 40px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; color: var(--primary);">ðŸŽ“</div>
                    <div>
                        <h1>Enhanced Student Portal</h1>
                        <div class="school-badge" id="dashboardSchoolBadge">
                            <i class="fas fa-school"></i> School: marist_brothers_high_eda4a711
                        </div>
                    </div>
                </div>

                <div class="header-actions">
                    <button class="btn btn-light" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-light" id="printBtn">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button class="btn btn-light" id="viewReportBtn" style="display: none;">
                        <i class="fas fa-chart-line"></i> View Report
                    </button>
                    <button class="btn btn-light" id="switchSchoolDashboardBtn">
                        <i class="fas fa-exchange-alt"></i> Switch School
                    </button>
                    <button class="btn btn-light" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <h3><i class="fas fa-user-circle"></i> Student Profile</h3>
                    <ul class="sidebar-menu">
                        <li><a href="#profile" class="active" data-section="profile"><i class="fas fa-id-card"></i> Personal Information</a></li>
                        <li><a href="#report" data-section="report"><i class="fas fa-chart-line"></i> Academic Report</a></li>
                        <li><a href="#documents" data-section="documents"><i class="fas fa-file-alt"></i> Documents</a></li>
                    </ul>
                </div>

                <div class="sidebar-section">
                    <h3><i class="fas fa-qrcode"></i> Quick Access</h3>
                    <div class="qr-section" style="padding: 15px;">
                        <canvas id="dynamicQR" style="width: 150px; height: 150px;"></canvas>
                        <p style="margin-top: 10px; font-size: 0.8rem;">Scan for quick login</p>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3><i class="fas fa-cog"></i> Settings</h3>
                    <ul class="sidebar-menu">
                        <li><a href="#settings"><i class="fas fa-key"></i> Change Password</a></li>
                        <li><a href="#help"><i class="fas fa-question-circle"></i> Help & Support</a></li>
                    </ul>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area" id="contentArea">
                <!-- Welcome Section -->
                <div class="welcome-section fade-in" id="welcomeSection">
                    <h2>Welcome back, <span id="welcomeName">Student</span>! ðŸ‘‹</h2>
                    <p>Access your complete academic profile and manage your information.</p>
                    <div style="margin-top: 15px; padding: 12px; background: white; border-radius: 8px; border-left: 4px solid var(--primary);">
                        <i class="fas fa-school"></i> School: <strong id="welcomeSchool">marist_brothers_high_eda4a711</strong>
                    </div>
                </div>

                <!-- Profile Section -->
                <div class="student-profile fade-in" id="profileSection">
                    <div class="profile-header">
                        <h2><i class="fas fa-user"></i> Student Profile</h2>
                        <div class="profile-status">
                            <i class="fas fa-check-circle"></i>
                            <span id="studentStatus">Active</span>
                        </div>
                    </div>

                    <div class="profile-grid" id="profileGrid">
                        <!-- Profile data will be populated here -->
                    </div>

                    <div class="qr-section">
                        <img id="studentQR" alt="Student QR Code">
                        <p><i class="fas fa-info-circle"></i> Scan this QR code for quick portal access from your mobile device</p>
                    </div>
                </div>

                <!-- Report Section -->
                <div class="report-section fade-in" id="reportSection" style="display: none;">
                    <div class="profile-header">
                        <h2><i class="fas fa-chart-line"></i> Academic Report</h2>
                        <button class="btn btn-light" id="downloadReportBtn" style="display: none;">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>

                    <div class="report-viewer" id="reportViewer">
                        <div class="loading" id="reportLoading">
                            <div class="loading-spinner"></div>
                            <p>Loading academic report...</p>
                        </div>
                        <img id="reportImage" class="report-image" alt="Academic Report">
                        <div id="noReportMessage" style="display: none; text-align: center;">
                            <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: var(--light); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; color: var(--secondary);">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <h3 style="color: var(--dark); margin-bottom: 10px;">Report Not Available</h3>
                            <p style="color: var(--secondary);">Your academic report is not yet available online.</p>
                            <p style="color: var(--secondary); font-size: 0.9rem;">Please contact your school administration for more information.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Scholastic Academy Pro - School marist_brothers_high_eda4a711</h3>
                <p>Enhanced Student Portal - Complete academic management solution</p>
                <div class="social-links">
                    <a href="https://www.youtube.com/channel/UCbpiTADcfPmIdywSX5-WCcg" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
                    <a href="https://high-voltage-technologies.itch.io" target="_blank" title="Itch.io"><i class="fab fa-itch-io"></i></a>
                    <a href="https://www.facebook.com/profile.php?id=61561637791826" target="_blank" title="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="https://discord.gg/q9syM7RuJ6" target="_blank" title="Discord"><i class="fab fa-discord"></i></a>
                    <a href="https://www.tiktok.com/@hvstechofficial" target="_blank" title="TikTok"><i class="fab fa-tiktok"></i></a>
                    <a href="https://whatsapp.com/channel/0029ValE9KQ7z4kiKXDsRl0T" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    <a href="https://www.instagram.com/hvstech_official" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Contact Information</h3>
                <ul class="footer-links">
                    <li><i class="fas fa-envelope"></i> Email: highvoltagesoftware8@gmail.com</li>
                    <li><i class="fas fa-phone"></i> WhatsApp: +263785558261</li>
                    <li><i class="fas fa-map-marker-alt"></i> Based in Zimbabwe</li>
                    <li><i class="fas fa-school"></i> Current School: marist_brothers_high_eda4a711</li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Powered By</h3>
                <p>High Voltage Software Technologies</p>
                <div style="width: 120px; height: 40px; background: white; border-radius: 5px; margin-top: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary);">HVST</div>
                <p style="font-size: 0.9rem; margin-top: 15px; color: #d1d5db;">Enterprise Education Solutions</p>
            </div>
        </div>
        
        <div class="copyright">
            <p>&copy; 2024 High Voltage Software Technologies. All rights reserved. | Enhanced Portal v2.0</p>
            <p style="font-size: 0.8rem; margin-top: 5px;">Powered by PostgreSQL & Advanced Web Technologies</p>
        </div>
    </footer>

    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- JSQR Library for QR Scanning -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

    <script>
        // Enhanced Portal Data
        const ENHANCED_PORTAL_ACCOUNTS = {
  "D05F09EC": {
    "password": "MBHS0002",
    "student_id": "MBHS0002",
    "name": "Jane Smith",
    "class": "1A1",
    "stream": "",
    "gender": "Female",
    "date_of_birth": "2004-08-22",
    "email": "jane@example.com",
    "phone": "98886756",
    "address": "456 Oak Ave",
    "emergency_contact": "",
    "medical_info": "",
    "sports": "Swimming, Tennis",
    "enrollment_date": "2023-01-15",
    "previous_school": "",
    "notes": "",
    "qr_code": "iVBORw0KGgoAAAANSUhEUgAAAMQAAADEAQAAAADo3bPGAAAB+UlEQVR4nN2YQQrdMBBDn8vfyzf49z9WbiCf4HXh31JKS6HYUJpF4iQQoYlGM+Mhvz7Wl9+8gH/7zRhjMmAwB5MJc4wxj+NEgTHL6oSyGj3N5wUjAGW4Hiar+9FxHGDmGQbmvvvrr/0Jh/Uuz4Ay3fwO42A0qiYSikbTszjDAfnp4YI8p/moipRIpY3qYT6Ipa0EsDXKDZwi6T4D/YAfjxsGa01JSkp7HidWsdhqkmpzgY/Z8QpWTGuO6xppbKG2WCqV8zgG0tpQYonmgg5K1KZAogq9wAeIblXL9qDeyVMlae235MlxPi9KJq4ZVgJCwdP1FFPbpqhpmiY38qdAkhYgjQAX/KDNtmsjNBBznM+Lmd3ldDJxlDdz9UY9jZQmEbe0z/PB/Lhw/570gu+020KbtKWmN/wgkVpNlUjqlfpDLY0QNLY05/k0gVBCm7ZbCVf4fIIVhJZ6QQc17Aq6/acKF/rE+UBGeJh9s5wrAMf7xMYE2KXB79zO+2itIRRCGq70iW5HEFNjE3sjf0oat6gDKaUX+pAdqI+/haRwI3/8RO5Th1LjeV3veXvtFn5mdM1dja7Mc0lJYjDd1wu+k5iUsPuDQo7r+jMHP+CC+cyMyhxe2SlZ8F5zBvLw2UO48X+ozV7tmftCfwDs0kD3rJXkvL+N/2xf7Csp4fsREYxiOQAAAABJRU5ErkJggg==",
    "school_id": "marist_brothers_high_eda4a711"
  },
  "BAF990BC": {
    "password": "MBHS0001",
    "student_id": "MBHS0001",
    "name": "John Doe",
    "class": "1A1",
    "stream": "",
    "gender": "Male",
    "date_of_birth": "2005-05-15",
    "email": "john@example.com",
    "phone": "78666786",
    "address": "123 Main St",
    "emergency_contact": "",
    "medical_info": "",
    "sports": "Football, Basketball",
    "enrollment_date": "2023-01-10",
    "previous_school": "",
    "notes": "",
    "qr_code": "iVBORw0KGgoAAAANSUhEUgAAAMQAAADEAQAAAADo3bPGAAAB/klEQVR4nN2YQarYMBBDnz/dyzf49z9WbiCf4HXhdFN+KbQ2lHoRSAweZM1oNBny9Vofv9iAf3tnjDEXY7JgMcZkjjHm4TgYDZaaBm2NpmfjfIMROpcM18NkFUZO39s3AKaDmQE+0zX/+LTf7XS5+gALmH972pfLaJLURKDxBj/DAfnp44I8p/HozrESUWxUD+NBCIgE2BHbno+T0oRUrSXFcJofjLJjpCQl5QoeaGPQ2oTa5g4/TRuKscZcwbOPtlpaFD3OzwedDNaCOeAzHSNMelwPME0o2DQShAv8SFokRdxFeqFOA7WhbREivVE/Zec03a/hTr6RVipvStNwo35SSGgB0ghwAY/krZ+IxMbkfP+Z3Z6AT1iO8gmrOezffuCpSdzSE3ODn/0sQNJW4Eb9GFu1pBaNvdF/amI1VSKpN+rHYpGgkEDlAj+F7D5Ku/kxx30VmgrE+qo22gv8JIl9jWKF1hv6JjX70vL28fN6gKbbkCatstX0Bp42iW5DlQi9kQcGSHYl2cQrfrSkCfb1pdL0gj9Ik/zQN92Cd0MPVCBtpEQjx/nZ8zbmAWZm15hMLvi36HbX2Z0n5sK88AFjMskarLHmQ9caeBrPu7Oe+Fg6mVjGhTmYZM/CJdsyXpiD33m72+0IJlzoP++8/YRBmS4ygee03xn/2X+x71cjD56uhDbvAAAAAElFTkSuQmCC",
    "school_id": "marist_brothers_high_eda4a711"
  }
};
        const SCHOOL_CONFIG = {
  "school_name": "Scholastic Academy Pro",
  "current_school_id": "1",
  "enable_sync": "1",
  "sync_host": "localhost",
  "sync_port": "5432",
  "sync_db": "suitesync_hub",
  "sync_user": "postgres",
  "sync_password": "password"
};
        const CURRENT_SCHOOL_ID = "marist_brothers_high_eda4a711";

        // DOM Elements
        const schoolSelectionPage = document.getElementById('schoolSelectionPage');
        const loginPage = document.getElementById('loginPage');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const errorMessage = document.getElementById('errorMessage');
        const qrScannerBtn = document.getElementById('qrScannerBtn');
        const cameraContainer = document.getElementById('cameraContainer');
        const qrVideo = document.getElementById('qrVideo');
        const stopCameraBtn = document.getElementById('stopCameraBtn');
        const switchSchoolBtn = document.getElementById('switchSchoolBtn');
        const switchSchoolDashboardBtn = document.getElementById('switchSchoolDashboardBtn');
        
        // Dashboard elements
        const welcomeName = document.getElementById('welcomeName');
        const welcomeSchool = document.getElementById('welcomeSchool');
        const studentStatus = document.getElementById('studentStatus');
        const profileGrid = document.getElementById('profileGrid');
        const studentQR = document.getElementById('studentQR');
        const dynamicQR = document.getElementById('dynamicQR');
        const currentSchoolName = document.getElementById('currentSchoolName');
        const currentSchoolId = document.getElementById('currentSchoolId');
        const currentSchoolBadge = document.getElementById('currentSchoolBadge');
        const dashboardSchoolBadge = document.getElementById('dashboardSchoolBadge');
        const selectedSchoolName = document.getElementById('selectedSchoolName');
        
        // Report elements
        const reportSection = document.getElementById('reportSection');
        const reportImage = document.getElementById('reportImage');
        const reportLoading = document.getElementById('reportLoading');
        const noReportMessage = document.getElementById('noReportMessage');
        const downloadReportBtn = document.getElementById('downloadReportBtn');
        const viewReportBtn = document.getElementById('viewReportBtn');
        
        // Sections
        const welcomeSection = document.getElementById('welcomeSection');
        const profileSection = document.getElementById('profileSection');
        
        // Buttons
        const logoutBtn = document.getElementById('logoutBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const printBtn = document.getElementById('printBtn');
        
        // Sidebar navigation
        const sidebarLinks = document.querySelectorAll('.sidebar-menu a');
        
        // Current user data
        let currentUser = null;
        let currentSchool = {
            id: CURRENT_SCHOOL_ID,
            name: "Scholastic Academy Pro - School marist_brothers_high_eda4a711"
        };
        let qrScanner = null;
        let stream = null;
        let currentReportUrl = null;

        // Force light theme on load
        document.documentElement.setAttribute('data-theme', 'light');
        document.body.classList.add('light-theme');
        
        // Update color scheme meta
        const metaThemeColor = document.querySelector('meta[name="theme-color"]');
        if (!metaThemeColor) {
            const meta = document.createElement('meta');
            meta.name = 'theme-color';
            meta.content = '#f8fafc';
            document.head.appendChild(meta);
        } else {
            metaThemeColor.content = '#f8fafc';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            handleAutoLogin();
            setupEventListeners();
            setupSidebarNavigation();
            loadAvailableSchools();
        });

        function setupEventListeners() {
            // Login form
            loginForm.addEventListener('submit', handleLogin);
            
            // QR scanner
            qrScannerBtn.addEventListener('click', toggleQRScanner);
            stopCameraBtn.addEventListener('click', stopQRScanner);
            
            // School switching
            switchSchoolBtn.addEventListener('click', showSchoolSelection);
            switchSchoolDashboardBtn.addEventListener('click', showSchoolSelection);
            
            // Dashboard buttons
            logoutBtn.addEventListener('click', logout);
            refreshBtn.addEventListener('click', refreshDashboard);
            printBtn.addEventListener('click', printDashboard);
            downloadReportBtn.addEventListener('click', downloadReport);
            viewReportBtn.addEventListener('click', () => showSection('report'));
        }

        function setupSidebarNavigation() {
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active state
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show selected section
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });
        }

        function showSection(section) {
            // Hide all sections
            [welcomeSection, profileSection, reportSection].forEach(sec => {
                sec.style.display = 'none';
            });
            
            // Show selected section
            switch(section) {
                case 'profile':
                    profileSection.style.display = 'block';
                    viewReportBtn.style.display = 'none';
                    break;
                case 'report':
                    reportSection.style.display = 'block';
                    viewReportBtn.style.display = 'none';
                    loadReportImage();
                    break;
                default:
                    welcomeSection.style.display = 'block';
                    viewReportBtn.style.display = 'none';
            }
        }

        function loadAvailableSchools() {
            // Extract unique schools from accounts data
            const schools = new Set();
            Object.values(ENHANCED_PORTAL_ACCOUNTS).forEach(account => {
                if (account.school_id) {
                    schools.add(account.school_id);
                }
            });
            
            const schoolList = document.getElementById('schoolList');
            schoolList.innerHTML = '';
            
            // Add current school as first option
            const currentSchoolOption = document.createElement('div');
            currentSchoolOption.className = 'school-option';
            currentSchoolOption.onclick = () => selectSchool(currentSchool.id, currentSchool.name);
            currentSchoolOption.innerHTML = `
                <i class="fas fa-graduation-cap"></i>
                <div class="school-info">
                    <div class="school-name">${currentSchool.name}</div>
                    <div class="school-id">School ID: ${currentSchool.id}</div>
                </div>
                <i class="fas fa-chevron-right"></i>
            `;
            schoolList.appendChild(currentSchoolOption);
            
            // Add other schools
            schools.forEach(schoolId => {
                if (schoolId !== currentSchool.id) {
                    const schoolOption = document.createElement('div');
                    schoolOption.className = 'school-option';
                    schoolOption.onclick = () => selectSchool(schoolId, `School ${schoolId}`);
                    schoolOption.innerHTML = `
                        <i class="fas fa-school"></i>
                        <div class="school-info">
                            <div class="school-name">School ${schoolId}</div>
                            <div class="school-id">ID: ${schoolId}</div>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    `;
                    schoolList.appendChild(schoolOption);
                }
            });
        }

        function selectSchool(schoolId, schoolName) {
            currentSchool = {
                id: schoolId,
                name: schoolName
            };
            
            // Update UI
            selectedSchoolName.textContent = schoolName;
            currentSchoolName.textContent = schoolName;
            currentSchoolId.textContent = schoolId;
            currentSchoolBadge.innerHTML = `<i class="fas fa-school"></i> School ID: <span>${schoolId}</span>`;
            dashboardSchoolBadge.innerHTML = `<i class="fas fa-school"></i> School: ${schoolId}`;
            welcomeSchool.textContent = schoolId;
            
            // Show login page
            schoolSelectionPage.style.display = 'none';
            loginPage.style.display = 'flex';
        }

        function showSchoolSelection() {
            // Clear any current session
            currentUser = null;
            sessionStorage.removeItem('enhancedPortalUser');
            sessionStorage.removeItem('currentSchool');
            
            // Show school selection
            dashboard.style.display = 'none';
            loginPage.style.display = 'none';
            schoolSelectionPage.style.display = 'flex';
            
            // Clear login form
            loginForm.reset();
        }

        function handleAutoLogin() {
            const urlParams = new URLSearchParams(window.location.search);
            const portalId = urlParams.get('portalId');
            const password = urlParams.get('password');
            const schoolId = urlParams.get('schoolId');
            const autoLogin = urlParams.get('autoLogin');
            
            if (schoolId) {
                selectSchool(schoolId, `School ${schoolId}`);
            }
            
            if (autoLogin === 'true' && portalId && password) {
                if (authenticateUser(portalId, password)) {
                    window.history.replaceState(null, null, window.location.pathname);
                }
            }
            
            // Check session storage
            const sessionUser = sessionStorage.getItem('enhancedPortalUser');
            const sessionSchool = sessionStorage.getItem('currentSchool');
            
            if (sessionUser && sessionSchool) {
                currentUser = JSON.parse(sessionUser);
                currentSchool = JSON.parse(sessionSchool);
                showDashboard();
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const portalId = document.getElementById('portalId').value.trim().toUpperCase();
            const password = document.getElementById('password').value;
            
            if (authenticateUser(portalId, password)) {
                loginForm.reset();
                errorMessage.style.display = 'none';
            } else {
                showError('Invalid Portal ID or password. Please try again.');
            }
        }

        function authenticateUser(portalId, password) {
            const account = ENHANCED_PORTAL_ACCOUNTS[portalId];
            
            if (account && account.password === password && account.school_id === currentSchool.id) {
                currentUser = {
                    portalId: portalId,
                    ...account
                };
                
                // Store in session
                sessionStorage.setItem('enhancedPortalUser', JSON.stringify(currentUser));
                sessionStorage.setItem('currentSchool', JSON.stringify(currentSchool));
                
                // Show dashboard
                showDashboard();
                
                return true;
            }
            
            return false;
        }

        function showError(message) {
            errorMessage.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            errorMessage.style.display = 'block';
            
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        function showDashboard() {
            // Update welcome message
            welcomeName.textContent = currentUser.name;
            welcomeSchool.textContent = currentSchool.id;
            studentStatus.textContent = 'Active';
            
            // Load profile data
            loadProfileData();
            
            // Load QR code
            loadQRCode();
            
            // Show report button if user has a report
            checkReportAvailability();
            
            // Show dashboard
            schoolSelectionPage.style.display = 'none';
            loginPage.style.display = 'none';
            dashboard.style.display = 'block';
            
            // Show welcome section by default
            showSection('profile');
        }

        function loadProfileData() {
            const user = currentUser;
            
            // Personal Information
            const personalInfo = `
                <div class="profile-card">
                    <h3><i class="fas fa-user-circle"></i> Personal Information</h3>
                    <div class="info-item">
                        <span class="info-label">Full Name:</span>
                        <span class="info-value">${user.name}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Student ID:</span>
                        <span class="info-value">${user.student_id}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">School ID:</span>
                        <span class="info-value">${user.school_id}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Date of Birth:</span>
                        <span class="info-value">${user.date_of_birth || 'N/A'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Gender:</span>
                        <span class="info-value">${user.gender || 'N/A'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Email:</span>
                        <span class="info-value">${user.email || 'N/A'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Phone:</span>
                        <span class="info-value">${user.phone || 'N/A'}</span>
                    </div>
                </div>
            `;
            
            // Academic Information
            const academicInfo = `
                <div class="profile-card">
                    <h3><i class="fas fa-graduation-cap"></i> Academic Information</h3>
                    <div class="info-item">
                        <span class="info-label">Class:</span>
                        <span class="info-value">${user.class}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Stream:</span>
                        <span class="info-value">${user.stream || 'N/A'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Enrollment Date:</span>
                        <span class="info-value">${user.enrollment_date || 'N/A'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Sports:</span>
                        <span class="info-value">${user.sports || 'None'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Previous School:</span>
                        <span class="info-value">${user.previous_school || 'N/A'}</span>
                    </div>
                </div>
            `;
            
            // Contact & Medical Information
            const contactInfo = `
                <div class="profile-card">
                    <h3><i class="fas fa-address-book"></i> Contact & Medical</h3>
                    <div class="info-item">
                        <span class="info-label">Address:</span>
                        <span class="info-value">${user.address || 'N/A'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Emergency Contact:</span>
                        <span class="info-value">${user.emergency_contact || 'N/A'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Medical Information:</span>
                        <span class="info-value">${user.medical_info || 'None'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Notes:</span>
                        <span class="info-value">${user.notes || 'None'}</span>
                    </div>
                </div>
            `;
            
            // Portal Access Information
            const portalInfo = `
                <div class="profile-card">
                    <h3><i class="fas fa-key"></i> Portal Access</h3>
                    <div class="info-item">
                        <span class="info-label">Portal ID:</span>
                        <span class="info-value">${user.portalId}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Password:</span>
                        <span class="info-value">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Login URL:</span>
                        <span class="info-value">enhanced-portal.html</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">School:</span>
                        <span class="info-value">${SCHOOL_CONFIG.school_name || 'Scholastic Academy'}</span>
                    </div>
                    <button class="btn" onclick="showCredentials()" style="margin-top: 15px; width: 100%; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white;">
                        <i class="fas fa-eye"></i> Show Credentials
                    </button>
                </div>
            `;
            
            profileGrid.innerHTML = personalInfo + academicInfo + contactInfo + portalInfo;
        }

        function loadQRCode() {
            const user = currentUser;
            const qrData = `https://${window.location.hostname}${window.location.pathname}?portalId=${user.portalId}&password=${user.password}&schoolId=${user.school_id}&autoLogin=true`;
            
            // Generate QR code for sidebar
            QRCode.toCanvas(dynamicQR, qrData, {
                width: 150,
                height: 150,
                margin: 1,
                color: {
                    dark: '#374151',
                    light: '#ffffff'
                }
            }, function(error) {
                if (error) console.error(error);
            });
            
            // Set main QR code if available
            if (user.qr_code) {
                studentQR.src = `data:image/png;base64,${user.qr_code}`;
                studentQR.style.display = 'block';
            }
        }

        function checkReportAvailability() {
            // Report image URLs to try
            const reportUrls = [
                `https://raw.githubusercontent.com/hvstechzw/Scholastic-Services-Web-Portal/main/reports/${currentUser.student_id}.png`,
                `https://raw.githubusercontent.com/hvstechzw/Scholastic-Services/main/reports/${currentUser.student_id}.png`,
                `reports/${currentUser.student_id}.png`,
                `../reports/${currentUser.student_id}.png`
            ];
            
            // Check if any report exists
            let reportFound = false;
            
            reportUrls.forEach(url => {
                const img = new Image();
                img.onload = function() {
                    if (!reportFound) {
                        reportFound = true;
                        currentReportUrl = url;
                        viewReportBtn.style.display = 'inline-flex';
                    }
                };
                img.src = url;
            });
        }

        function loadReportImage() {
            if (!currentReportUrl) {
                reportLoading.style.display = 'none';
                noReportMessage.style.display = 'block';
                downloadReportBtn.style.display = 'none';
                return;
            }
            
            const img = new Image();
            img.onload = function() {
                reportImage.src = this.src;
                reportImage.style.display = 'block';
                reportLoading.style.display = 'none';
                downloadReportBtn.style.display = 'inline-flex';
            };
            img.onerror = function() {
                reportLoading.style.display = 'none';
                noReportMessage.style.display = 'block';
                downloadReportBtn.style.display = 'none';
            };
            img.src = currentReportUrl + '?t=' + new Date().getTime();
        }

        function downloadReport() {
            if (currentReportUrl) {
                const link = document.createElement('a');
                link.href = currentReportUrl;
                link.download = `academic_report_${currentUser.student_id}_${new Date().toISOString().split('T')[0]}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showSuccess('Report downloaded successfully!');
            }
        }

        // QR Scanner Functions
        function toggleQRScanner() {
            if (cameraContainer.style.display === 'block') {
                stopQRScanner();
            } else {
                startQRScanner();
            }
        }

        function startQRScanner() {
            navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'environment' }
            }).then(function(s) {
                stream = s;
                qrVideo.srcObject = stream;
                cameraContainer.style.display = 'block';
                qrScannerBtn.style.display = 'none';
                
                // Start QR code detection
                const canvasElement = document.createElement('canvas');
                const canvas = canvasElement.getContext('2d');
                
                function tick() {
                    if (qrVideo.readyState === qrVideo.HAVE_ENOUGH_DATA) {
                        canvasElement.height = qrVideo.videoHeight;
                        canvasElement.width = qrVideo.videoWidth;
                        canvas.drawImage(qrVideo, 0, 0, canvasElement.width, canvasElement.height);
                        
                        const imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
                        const code = jsQR(imageData.data, imageData.width, imageData.height);
                        
                        if (code) {
                            // Found a QR code
                            const qrData = code.data;
                            const params = new URLSearchParams(qrData.split('?')[1]);
                            const portalId = params.get('portalId');
                            const password = params.get('password');
                            const schoolId = params.get('schoolId');
                            
                            if (schoolId) {
                                selectSchool(schoolId, `School ${schoolId}`);
                            }
                            
                            if (portalId && password) {
                                stopQRScanner();
                                if (authenticateUser(portalId, password)) {
                                    showSuccess('QR code scanned successfully!');
                                }
                            }
                        }
                    }
                    
                    requestAnimationFrame(tick);
                }
                
                tick();
            }).catch(function(err) {
                showError('Camera access denied: ' + err.message);
            });
        }

        function stopQRScanner() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            cameraContainer.style.display = 'none';
            qrScannerBtn.style.display = 'inline-flex';
            qrVideo.srcObject = null;
        }

        // Dashboard Functions
        function logout() {
            currentUser = null;
            currentReportUrl = null;
            sessionStorage.removeItem('enhancedPortalUser');
            sessionStorage.removeItem('currentSchool');
            dashboard.style.display = 'none';
            schoolSelectionPage.style.display = 'flex';
            loginForm.reset();
        }

        function refreshDashboard() {
            if (currentUser) {
                loadProfileData();
                checkReportAvailability();
                showSuccess('Dashboard refreshed!');
            }
        }

        function printDashboard() {
            window.print();
        }

        function showCredentials() {
            if (currentUser) {
                alert(`Portal Credentials:\n\nSchool ID: ${currentUser.school_id}\nPortal ID: ${currentUser.portalId}\nPassword: ${currentUser.password}\n\nKeep these credentials secure!`);
            }
        }

        function showSuccess(message) {
            // Create success notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #059669, #047857);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            
            notification.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Add animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Export functions for button clicks
        window.showCredentials = showCredentials;
        window.selectSchool = selectSchool;
    </script>
</body>
</html>